const { createBot, createProvider, createFlow, addKeyword, EVENTS, addAnswer } = require('@bot-whatsapp/bot')

const QRPortalWeb = require('@bot-whatsapp/portal')
const BaileysProvider = require('@bot-whatsapp/provider/baileys')
const MockAdapter = require('@bot-whatsapp/database/mock')


const flowgracias = addKeyword('gracias')
    .addAnswer('Mucha gracias, estamos para servirte')




const flow1 = addKeyword('1')
    .addAnswer([
                '*Para realizar tu factura por favor enviame:*',
                ' ',
                '- Una foto de tu ticket üìù',
                '- Una foto de tu baucher üìÑ',
                '- Constancia de situaci√≥n fiscal actualizada üßæ',
                '- y un correo electronico üìß',
                '- Uno de nuestros asesores te apoyara lo m√°s r√°pido posible, gracias üßëüèº‚Äçüîß',
                '- agradecemos su preferencia',
                ' ',
                'si desea regresar al menu escriba *MENU*',
               ]
        ,
        null,
        null,
        
        [flowgracias]
        ,
        )
   
const flow2 = addKeyword('2')
    .addAnswer('entra en el siguiente enlance')
    .addAnswer('https://www.ticket-factura.com/Grupo/cima')
    .addAnswer([
        ' ',
        'si desea regresar al menu escriba *MENU*',
            ],
        null, 
        null,
            )    

const flow3 = addKeyword('3')
    .addAnswer('Si necesitas corregir una factura')
    .addAnswer('envianos')
    
    .addAnswer('foto de tu factura')
    .addAnswer('si es a otro nombre, tu constancia de situaci√≥n fiscal')
    .addAnswer('si es metodo de pago, foto de tu baucher')
    .addAnswer([
        ' ',
        'si desea regresar al menu escriba *MENU*',
            ],
        null,
        null
            )
const flow4 = addKeyword('4')
    .addAnswer('COMUNICATE CON NOSOTROS PARA RESOLVER CUALQUIER DUDA')
    .addAnswer('TELEFONO: 7828250902')
    .addAnswer('CORREO: clientes@cimadeltajin.com')
    .addAnswer('PAGINA: www.cimadeltajin.com')
    .addAnswer([
        ' ',
        'si desea regresar al menu escriba *MENU*',
            ],
        null,
        null
            )

const flow5 = addKeyword('5')
    .addAnswer('Tienes alg√∫na sugerencia o queja')
    .addAnswer('escribenos en este apartado de manera detallada en que te podemos apoyar',{capture:true},(ctx) =>{
        
        
        console.log('mensaje entrante: ',ctx.body)   
        
    })
    


    .addAnswer('revisaremos su caso detalladamente y trabajaremos para resolverlo', {delay:90000})
    .addAnswer('agradecemos su preferencia') 
    .addAnswer([
        ' ',
        'si desea regresar al menu escriba *MENU*',
            ],
        null,
        null
            )

const flow6 = addKeyword('6')
            .addAnswer('Hola, indicanos que gasolinera estas buscando')
            .addAnswer('Te redirigiremos a google maps')
          
            .addAnswer('*CIMA COATZINTLA*                                                                    Encuentra tu estaci√≥n en el siguiente enlace https://maps.app.goo.gl/WRLDKgMmARCRaPSB8 ',
                { media: 'https://i.imgur.com/aVIS0Mz.png' }
                         )

const flow11215 = addKeyword('2')
            .addAnswer('Cima del Taj√≠n agradece tu preferencia')
            .addAnswer('Encuentra tu estaci√≥n en el siguiente enlace')
            .addAnswer('https://maps.app.goo.gl/QSgqR24oaWwRht6n6')
            .addAnswer([
                ' ',
                'si desea regresar al menu escriba *MENU*',
            ])

const flow3620 = addKeyword('3')
            .addAnswer('Cima del Taj√≠n agradece tu preferencia')
            .addAnswer('Encuentra tu estaci√≥n en el siguiente enlace')
            .addAnswer('https://maps.app.goo.gl/yXpqdxWGntAsfpMF9')
            .addAnswer([
                ' ',
                'si desea regresar al menu escriba *MENU*',
            ])

const flow12712 = addKeyword('4')
            .addAnswer('Cima del Taj√≠n agradece tu preferencia')
            .addAnswer('Encuentra tu estaci√≥n en el siguiente enlace')
            .addAnswer('https://maps.app.goo.gl/aJWkqJn7oiquaaW58')
            .addAnswer([
                ' ',
                'si desea regresar al menu escriba *MENU*',
            ])

const flow7 = addKeyword('7')
    .addAnswer( 'Hola para iniciar el proceso de reclutamiento, deber√°s acudir a nuestro departamento de recursos humanos dirigido a la Lic. Alma Sanchez con la siguiente documentaci√≥n:')
    .addAnswer(
        [
   
    '- Cv o solicitud',
    '- Acta de nacimiento',
    '- √öltimo grado de estudios',
    '- Copia de INE',
    '- Numero de seguro social',
    '- Constancia de situaci√≥n fiscal RFC',
    '- Comprobante de domicilio',
        ])

    .addAnswer('le comparto la direcci√≥n en la siguiente liga https://goo.gl/maps/n8xDo8H6qBnoRdWz5')
    .addAnswer('puede enviar mensaje o llamar al numero 7821758152 , correo gdn.administracion@grupogdh.com')
    .addAnswer('Que tengas un buen d√≠a')
    .addAnswer([
        ' ',
        'si desea regresar al menu escriba *MENU*',
    ]
    ,
    null,
    null,
    )


const flow8 = addKeyword('8')
.addAnswer('T√©rminos y Condiciones del GIVE AWAY para pap√°*"')
.addAnswer('*TODOS PUEDEN PARTICIPAR*')   

    .addAnswer([
        '*1. Organizador del Concurso*',
        '*‚Ä¢* El Give Away es organizado por la gasolinera Cima del Taj√≠n.',
             ],{delay:100})
    .addAnswer([
        '*2. Elegibilidad*',
        '*‚Ä¢* El Concurso est√° abierto al p√∫blico en general.',
    
            ],{delay:110})
    .addAnswer([
        '*3. Duraci√≥n del Concurso*',
        '*‚Ä¢* El Concurso comienza el 01 de junio de 2024 y termina el 29 de junio de 2024',
        '*‚Ä¢* Todas las participaciones deben ser recibidas antes de la fecha de finalizaci√≥n para ser consideradas.',
        '*‚Ä¢* Fecha de anuncio del ganador 29 de junio de 2024',
            ],{delay:120})
    .addAnswer([
        '*4. C√≥mo Participar*',
        '*‚Ä¢* 1.- Sigue Nuestra pagina de facebook y canal de WhatsApp üòúhttps://whatsapp.com/channel/0029Va9JGO22v1IrQUVgJ40L',
        '*‚Ä¢* 2.- Reacciona y comparte esta publicaci√≥nü•∞',
        '*‚Ä¢* 3.- etiqueta a tres de tus amigos en un solo comentarioü§©',
            ],{delay:130})
    .addAnswer([
        '*5. Criterios de Selecci√≥n*',
        '*‚Ä¢* Los ganadores se daran a conocer en un live realizado el d√≠a de la finalizaci√≥n del concurso',
        
            ],{delay:140})
    .addAnswer([
        '*6. Uso del Material Enviado*',
        '*‚Ä¢* Los participantes otorgan al Organizador el derecho no exclusivo, transferible y libre de regal√≠as para usar, reproducir, modificar, publicar, distribuir y mostrar la informaci√≥n en cualquier medio de comunicaci√≥n.',
        '*‚Ä¢* Los participantes autorizan de manera expresa al organizador a hacer uso del derecho de uso de imagen.',
        '*‚Ä¢* El participante es responsable de contar con la autorizaci√≥n de sus amigos que aparezcan en el post, en caso de controversia con terceros, el participante dejar√° en paz y salvo al organizador',
        
            ],{delay:150})
    .addAnswer([
        '*7. Premios*',
        '*‚Ä¢* Un Galaxy Wach 4 SM-R860.',
       
            ],{delay:160})
    .addAnswer([
        '*8. Privacidad*',
        '*‚Ä¢* El Organizador recopilar√° y tratar√° los datos personales de los participantes de acuerdo con su pol√≠tica de privacidad.'
            ],{delay:170})
    .addAnswer([
        '*9. Aceptaci√≥n de los T√©rminos y Condiciones*',
        '*‚Ä¢* Al participar en el Concurso, los participantes aceptan estos t√©rminos y condiciones.',
        '*‚Ä¢* El Organizador se reserva el derecho de modificar estos t√©rminos y condiciones en cualquier momento y a su entera discreci√≥n.',
            ],{delay:180})
   
    .addAnswer([
        ' ',
        '_¬øQuieres conocer todos nuestros servicios?_, escribe *MENU*',
        ' ',
            ],{delay:190})



////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

const flowsecundario = addKeyword(['bien dia','Hola','buenos dias','buenas tardes','buenas noches','hola buen','bue','tarde','dias','Vi esto en Facebook...',
    'podr√≠as darme m√°s informaci√≥n de...','me enviar√≠an m√°s','quiero chatear con alguien','quiero empleo',
    'Quiero Saber de todos tus servicios...','terminos','Condiciones'])
        
            .addAnswer(
                [  
                  
                    '*Hola soy "Nimbe"* Tu Asistente virtual.',
                    'Bienvenido a _CimaWhats_',
                    //'Bienvenido a _CimaWhats_, Consulta como puedes participar en nuestro *Give Away Para Pap√°* en la opci√≥n 8 o en https://atom.bio/cima_del_tajin',
                    ' ',
                    '*¬øEn que puedo ayudarte? escribe una opci√≥n ü§î*',
                    ' ',
                    ' ',
                    
            
               ' 1Ô∏è‚É£ *Facturaci√≥n por WhastApp*', 
               ' 2Ô∏è‚É£ *Facturaci√≥n en linea*',
               ' 3Ô∏è‚É£ *Correcci√≥nes de facturas*', 
               ' 4Ô∏è‚É£ *Contacto*',
               ' 5Ô∏è‚É£ *Sugerencias o Queja*',
               ' 6Ô∏è‚É£ *Localiza tu estaci√≥n*',
               ' 7Ô∏è‚É£ *Informes de vacantes*',
               //' 8Ô∏è‚É£ *‚≠ê"GIVE AWAY PARA PAP√Å"‚≠ê*', 
               ///' 9Ô∏è‚É£ *Terminos y condiciones Presume tu Nave*', 
              
            ],
            { media: 'https://i.imgur.com/SA2Zv9o.png' },
            null,
            [flow1,flow2,flow3,flow4,flow5,flow6,flow7,flow8]
            ,)
            
/////////////////////////////////////////////////////////////////////SUB MENU ///////////////////////////////////////////////////////////////////////////////////////////////////////

const flowPrincipal = addKeyword('Facturar por WhatsApp')
            .addAnswer( 
            [
                
                '*-¬°Hola! Soy Nimbe tu asistente virtual*, para ayudarte a realizar tu factura por favor enviame:',
                ' ',
                '- Una foto de tu ticket üìù',
                '- Una foto de tu baucher üìÑ',
                '- Constancia fiscal actualizada üßæ',
                '- y un correo electronico üìß',
                '- Uno de nuestros asesores te apoyara lo m√°s r√°pido posible, gracias üßëüèº‚Äçüîß',
                '- agradecemos su preferencia',
                '- Tiempo de espera *30 min*',
                ' ',
                ' ',
                '‚≠êNecesita algo m√°s escriba *MENU*‚≠ê',
            ],
            { media: 'https://i.imgur.com/9INS0L7.png' },
            null,
            )

          

/////////////////////////////////////////////////////////////////////SUB MENU ///////////////////////////////////////////////////////////////////////////////////////////////////////

const flowmenu = addKeyword('menu')
        
            .addAnswer(
                [   
                  
                    '*Hola soy "Nimbe"* Tu Asistente virtual.',
                    'Bienvenido a _CimaWhats_',
                    ' ',
                    '*¬øEn que puedo ayudarte? escribe una opci√≥n ü§î*',
                    ' ',
                    ' ',
                    
            
               ' 1Ô∏è‚É£ *Facturaci√≥n por WhastApp*', 
               ' 2Ô∏è‚É£ *Facturaci√≥n en linea*',
               ' 3Ô∏è‚É£ *Correcci√≥nes de facturas*', 
               ' 4Ô∏è‚É£ *Contacto*',
               ' 5Ô∏è‚É£ *Sugerencias o Queja*',
               ' 6Ô∏è‚É£ *Localiza tu estaci√≥n*',
               ' 7Ô∏è‚É£ *Informes de vacantes*',
               //' 8Ô∏è‚É£ *‚≠ê"GIVE AWAY PARA PAP√Å"‚≠ê*', 
               ///' 9Ô∏è‚É£ *Terminos y condiciones Presume tu Nave*', 
              
            ],
            { media: 'https://i.imgur.com/VhTREMv.png' },
            null,
            [flow1,flow2,flow3,flow4,flow5,flow6,flow7,flow8]
            ,)



///////////////////////////////////////////////////////////**FLOW para hacer pruebas **/////////////////////////////////////////////////////////////

const flowpruebas = addKeyword('claveactivador')
            .addAnswer(
                [
                '-¬°Hola! Soy Nimbe tu asistente virtual, para ayudarte a realizar tu factura por favor enviame:',
                ' ',
                '* Una foto de tu ticket üìù',
                '* Una foto de tu baucher üìÑ',
                '* Constancia fiscal actualizada üßæ',
                '* y un correo electronico üìß',
                '* Uno de nuestros asesores te apoyara lo m√°s r√°pido posible, gracias üßëüèº‚Äçüîß',
                '* Tiempo de espera 30 min',
                ' ',
                '"Vota" por tu favorito en nuestro concurso de trajes tipicos picale a unos de los siguientes linck ',
                ' ',
                'Canal de WhatsApp https://whatsapp.com/channel/0029Va9JGO22v1IrQUVgJ40L',
                'Comunidad de WhatsApp https://chat.whatsapp.com/JWGm47795PL41pnE7Mil3p',
                'Facebook Cimadeltaj√≠n https://www.facebook.com/cimadeltajin/',
                ' ',
                '‚≠êNecesita algo m√°s escriba MENU‚≠ê'
                ],
                { media: 'https://media.giphy.com/media/WhBeVM648P3DOktint/giphy.mp4' },
                null,
            )

const flowpruebas2 = addKeyword('codigo2')
            .addAnswer(
                [
                '-¬°Hola! Soy Nimbe tu asistente virtual, para ayudarte a realizar tu factura por favor enviame:',
                ' ',
                '* Una foto de tu ticket üìù',
                '* Una foto de tu baucher üìÑ',
                '* Constancia fiscal actualizada üßæ',
                '* y un correo electronico üìß',
                '* Uno de nuestros asesores te apoyara lo m√°s r√°pido posible, gracias üßëüèº‚Äçüîß',
                '* Tiempo de espera 30 min',
                ' ',
                '"Vota" por tu favorito en nuestro concurso de trajes tipicos picale a unos de los siguientes linck ',
                ' ',
                'Canal de WhatsApp https://whatsapp.com/channel/0029Va9JGO22v1IrQUVgJ40L',
                'Comunidad de WhatsApp https://chat.whatsapp.com/JWGm47795PL41pnE7Mil3p',
                'Facebook Cimadeltaj√≠n https://www.facebook.com/cimadeltajin/',
                ' ',
                '‚≠êNecesita algo m√°s escriba MENU‚≠ê'
                ],
                { media: 'https://i.imgur.com/bnobM62.png' },
                null,
            )






///////////////////////////////////////////////////////////**FLOW DE RESPUESTA AUTOMATICA**/////////////////////////////////////////////////////////////


const flowTerminos = addKeyword('Terminos','condiciones')
.addAnswer('T√©rminos y Condiciones del GIVE AWAY para pap√°*"')
.addAnswer('*TODOS PUEDEN PARTICIPAR*')   

    .addAnswer([
        '*1. Organizador del Concurso*',
        '*‚Ä¢* El Give Away es organizado por la gasolinera Cima del Taj√≠n.',
             ],{delay:100})
    .addAnswer([
        '*2. Elegibilidad*',
        '*‚Ä¢* El Concurso est√° abierto al p√∫blico en general.',
    
            ],{delay:110})
    .addAnswer([
        '*3. Duraci√≥n del Concurso*',
        '*‚Ä¢* El Concurso comienza el 01 de junio de 2024 y termina el 26 de juio de 2024',
        '*‚Ä¢* Todas las participaciones deben ser recibidas antes de la fecha de finalizaci√≥n para ser consideradas.',
        '*‚Ä¢* Fecha de anuncio del ganador 26 de mayo de 2024',
            ],{delay:120})
    .addAnswer([
        '*4. C√≥mo Participar*',
        '*‚Ä¢* 1.- Sigue Nuestra pagina de facebook y canal de WhatsApp üòúhttps://whatsapp.com/channel/0029Va9JGO22v1IrQUVgJ40L',
        '*‚Ä¢* 2.- Reacciona y comparte esta publicaci√≥nü•∞',
        '*‚Ä¢* 3.- etiqueta a tres de tus amigos en un solo comentarioü§©',
            ],{delay:130})
    .addAnswer([
        '*5. Criterios de Selecci√≥n*',
        '*‚Ä¢* Los ganadores se daran a conocer en un live realizado el d√≠a de la finalizaci√≥n del concurso',
        
            ],{delay:140})
    .addAnswer([
        '*6. Uso del Material Enviado*',
        '*‚Ä¢* Los participantes otorgan al Organizador el derecho no exclusivo, transferible y libre de regal√≠as para usar, reproducir, modificar, publicar, distribuir y mostrar la informaci√≥n en cualquier medio de comunicaci√≥n.',
        '*‚Ä¢* Los participantes autorizan de manera expresa al organizador a hacer uso del derecho de uso de imagen.',
        '*‚Ä¢* El participante es responsable de contar con la autorizaci√≥n de sus amigos que aparezcan en el post, en caso de controversia con terceros, el participante dejar√° en paz y salvo al organizador',
        
            ],{delay:150})
    .addAnswer([
        '*7. Premios*',
        '*‚Ä¢* Un Galaxy Wach 4 SM-R860.',
       
            ],{delay:160})
    .addAnswer([
        '*8. Privacidad*',
        '*‚Ä¢* El Organizador recopilar√° y tratar√° los datos personales de los participantes de acuerdo con su pol√≠tica de privacidad.'
            ],{delay:170})
    .addAnswer([
        '*9. Aceptaci√≥n de los T√©rminos y Condiciones*',
        '*‚Ä¢* Al participar en el Concurso, los participantes aceptan estos t√©rminos y condiciones.',
        '*‚Ä¢* El Organizador se reserva el derecho de modificar estos t√©rminos y condiciones en cualquier momento y a su entera discreci√≥n.',
            ],{delay:180})
   
    .addAnswer([
        ' ',
        '_¬øQuieres conocer todos nuestros servicios?_, escribe *MENU*',
        ' ',
            ],{delay:190})


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

const flowquejas = addKeyword('platicanos tu sugerencia o queja')
    .addAnswer('Tienes alg√∫na sugerencia o queja')
    .addAnswer('escribenos en este apartado de manera detallada en que te podemos apoyar',{capture:true},(ctx) =>{
        
        
        console.log('mensaje entrante: ',ctx.body)   
        
    })
    


    .addAnswer('revisaremos su caso detalladamente y trabajaremos para resolverlo', {delay:90000})
    .addAnswer('agradecemos su preferencia') 
    .addAnswer([
        ' ',
        'si desea regresar al menu escriba *MENU*',
            ],
        null,
        null
        
            )
    





    ///////////main////////////main///////////////main//////////////////main///////////main////////////////main/////////////////main///////////////main///////////////main//////////////main



    const main = async () => {
    const adapterDB = new MockAdapter()
    const adapterFlow = createFlow([flowPrincipal,flowsecundario,flowTerminos,flowmenu,flowpruebas,flowpruebas2])
    const adapterProvider = createProvider(BaileysProvider)

    createBot({
        flow: adapterFlow,
        provider: adapterProvider,
        database: adapterDB,
    })

    QRPortalWeb({port:8080})
}

main()
 